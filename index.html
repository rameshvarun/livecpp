<html>
<head>
	<title>CS 106b Live Coding</title>
	
	<style type="text/css" media="screen">
	  #editor {
        /*position: absolute;*/
        /*top: 0;
        right: 0;
        bottom: 0;
        left: 0;*/
        height: 100%;
        border-right: 1px solid #aaaaaa;
   	 }
	</style>

	<script src="//code.jquery.com/jquery-1.11.2.js"></script>

	<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
	<script src="/socket.io/socket.io.js"></script>

	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

	<script src="//cdnjs.cloudflare.com/ajax/libs/mousetrap/1.4.6/mousetrap.min.js"></script>

	<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
</head>

<body>
	<div class="row">
		<div class="col-xs-6" id="editor"></div>
		<div class="col-xs-6" id="problem">
			<div id="desc"></div>
			<div id="results"></div>
		</div>
	</div>

	<script id="results-template" type="text/x-handlebars-template">
		{{#each results}}
			<div class="panel {{#if passed}}panel-success{{else}}panel-danger{{/if}}">
				<div class="panel-heading">
					<h3 class="panel-title">{{name}}
					<span class='glyphicon glyphicon-chevron-down pull-right' aria-hidden='true'></span>
					</h3>

				</div>
				<div class="panel-body" hidden>
					Input: <pre><code>{{input}}</code></pre>
					Expected Output: <pre><code>{{expected}}</code></pre>
					Output: <pre><code>{{output}}</code></pre>
				</div>
			</div>
		{{/each}}
	</script>

	<script>
		// Initialize ACE editor
	    var editor = ace.edit("editor");
	    editor.setTheme("ace/theme/monokai");
	    editor.getSession().setMode("ace/mode/c_cpp");
	    editor.setShowPrintMargin(false);
	    
	    // Make socket connection
	    var socket = io();

	    Mousetrap.bind(['ctrl+s','command+s'], function(e) {
		    if (e.preventDefault) e.preventDefault();
		    else e.returnValue = false;
		    console.log("Sending program to be run.");
		    socket.emit("run", editor.getSession().getValue());

		    return false;
		});

		//ACE Editor key bindings
		editor.commands.addCommand({
			name: "save",
			bindKey: {win: "Ctrl-s", mac: "Command-s"},
			exec: function(editor){
				console.log("Editor - Sending program to be run.");
		    	socket.emit("run", editor.getSession().getValue());
			}
		})

		socket.on("problem", function(problem) {
			editor.getSession().setValue(problem.starter)
			$("#desc").html(problem.desc);
		});

		var template = Handlebars.compile($("#results-template").html());
		socket.on("results", function(results) {
			$("#results").html(template({
				results: results
			}));

			$(".panel-heading").click(function() {
				$(this).parent().children(".panel-body").slideToggle();
			});
		});
	</script>
</body>
</html>